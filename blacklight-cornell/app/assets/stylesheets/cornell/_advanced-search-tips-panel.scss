/* ================= Vars ================= */
:root{
  --drawer-h: 28vh;      /* mobile bottom-sheet height */
  --edge-btn: 2.25rem;   /* diameter of ? / chevron */
  --edge-gap: .45rem;    /* gap from screen edge */
}

/* ================= Backdrop ================= */
.help-backdrop[hidden]{ display:none; }
.help-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.25);
  z-index:1040;
  pointer-events:none;
}

/* ================= Drawer ================= */
/* Mobile: bottom sheet */
.help-drawer{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  top:auto;
  width:100%;
  height:var(--drawer-h);
  max-height:80vh;
  background:#fff;
  border-top:1px solid #ddd;
  box-shadow:0 -6px 16px rgba(0,0,0,.08);
  transform:translateY(100%);
  transition:transform .25s ease-in-out;
  z-index:1050;
  display:flex;
  flex-direction:column;
  overscroll-behavior:contain;
}
.help-drawer.is-open{ transform:translateY(0); }

/* Desktop: right drawer */
@media (min-width:992px){
  .help-drawer{
    left:auto;
    width:92vw;
    max-width:420px;
    border-top:0;
    border-left:1px solid #ddd;
    box-shadow:-6px 0 16px rgba(0,0,0,.08);
    transform:translateX(100%);
    padding-bottom:0;
  }
  .help-drawer.is-open{ transform:translateX(0); }
}

/* ================= Header/Content ================= */
.help-drawer__header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:.5rem;
  padding:.75rem 1rem;
  border-bottom:1px solid #eee;
  background:#f9f9f9;
}
.help-drawer__content{
  padding:1rem;
  overflow-y:auto;
  line-height:1.5;
  -webkit-overflow-scrolling:touch;
  overscroll-behavior:contain;
}

/* ================= Field highlight ================= */
.help-target{ outline:2px solid #337ab7; outline-offset:2px; }

/* ================= Edge buttons (shared) ================= */
#help-toggle,
#help-chev{
  z-index:1060;
  width:var(--edge-btn); height:var(--edge-btn);
  border-radius:9999px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  background:#fff;
  border:1px solid #ddd;
  box-shadow:0 2px 10px rgba(0,0,0,.12);
  color:#555;
  transition:
          transform .15s ease,
          box-shadow .2s ease,
          background-color .2s ease,
          border-color .2s ease,
          color .2s ease;
}

/* Toggle: fixed bottom-center on mobile; hidden while open */
#help-toggle{
  position:fixed;
  left:50%;
  --base-transform: translateX(-50%);
  transform: var(--base-transform);
  bottom:calc(env(safe-area-inset-bottom,0px) + var(--edge-gap));
  text-decoration:none;
  touch-action:manipulation;
  -webkit-tap-highlight-color:transparent;
}
.help-open #help-toggle,
#help-toggle[aria-expanded="true"]{ display:none !important; }

/* Chevron: positioned relative to drawer; hidden by default */
#help-chev{
  position:absolute;
  display:none;
  cursor:pointer;
}
#help-chev .chev{
  display:inline-block;
  line-height:1;
  transition:transform .2s ease;
}

/* ---- Mobile chevron: centered on top edge, points DOWN when open ---- */
@media (max-width:991.98px){
  .help-drawer.is-open #help-chev{
    display:inline-flex;
    left:50%;
    top:calc(-.7 * var(--edge-btn));
    --base-transform: translateX(-50%);
    transform: var(--base-transform);
  }
  /* rotate to point DOWN */
  .help-drawer.is-open #help-chev .chev{ transform: rotate(270deg); }
}

/* ---- Desktop positions & behavior ---- */
@media (min-width:992px){
  /* Desktop toggle (still hidden when open) */
  #help-toggle{
    right:.25rem;
    left:auto;
    top:97.5%;
    bottom:auto;
    --base-transform: translateY(-50%);
    transform: var(--base-transform);
  }
  /* Desktop chevron: mid-edge, half outside; flip LEFT when open */
  #help-chev{
    top:50%;
    left:calc(-.7 * var(--edge-btn));
    --base-transform: translateY(-50%);
    transform: var(--base-transform);
  }
  .help-drawer.is-open #help-chev{ display:inline-flex; }
  .help-drawer.is-open #help-chev .chev{ transform: rotate(180deg); }
}

/* ================= Interactive states ================= */
#help-toggle:hover,
#help-chev:hover{
  transform: var(--base-transform) scale(1.06);
  box-shadow: 0 4px 14px rgba(0,0,0,.16);
  border-color:#c9c9c9;
}
#help-toggle:active,
#help-toggle.is-pressed,
#help-chev:active,
#help-chev.is-pressed{
  transform: var(--base-transform) scale(0.96);
  box-shadow: 0 1px 6px rgba(0,0,0,.12);
}
#help-toggle:focus-visible,
#help-chev:focus-visible{
  outline:none;
  box-shadow:
          0 0 0 3px rgba(51,122,183,.35),
          0 4px 14px rgba(0,0,0,.16);
  border-color:#337ab7;
}

/* ================= Emphasized keywords ================= */
.help-key{ font-weight:700; font-size:1.1em; }

/* Reduced motion */
@media (prefers-reduced-motion: reduce){
  #help-toggle, #help-chev{ transition:none !important; }
}
