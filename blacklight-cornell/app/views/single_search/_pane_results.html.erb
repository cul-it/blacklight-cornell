<div class="<%= key %> bento_compartment" id="<%= key.tr(" ", "_") %>">
  <% if result %>
    <% link_url = bento_all_results_link(key) %>
  <% end %>
  <h2 class="search-source">
    <%= link_to link_url, :title => "View all" do %>
      <i class="fa fa-<%= formats_icon_mapping(bento_title(key)) %>"></i>
      <%= bento_title(key) %>
    <% end %>
  </h2>
</div>
<% if result %>
  <% # our app chooses to use 'q' as the query param; the ajax loading controller %>
  <% # uses 'query'.This ordinarily is fine, but since we want this layout to work %>
  <% # for both, we have to look for both, oh well. %>
    <%= bento_search result  %>
    <div class="view-all">
      <% if key == "libguides" %>
        <%= link_to 'View All Research Guides', link_url, :class => "btn btn-outline-secondary btn-sm", :onclick => "javascript:_paq.push(['trackEvent', 'allResultsLink', 'LibGuides'])", :id => "link_top_libguides" %>
      <% else %>
        <%= link_to link_url, class: "btn btn-outline-secondary btn-sm", onclick: "javascript:_paq.push(['trackEvent', 'allResultsLink', '#{bento_blacklight_format(key) || bento_title(key)}'])", id: "link_top_" + downcast(key) do %>
          View
          <% if key == "ebsco_eds" %>
            results from
            <%= bento_title(key) %>
          <% else %> 
            <%= number_with_delimiter(result.total_items) %>
            <% if !result.nil? %>
              <% if key == "digitalCollections" || key == "institutionalRepositories" %>
                <%= bento_title(key) %>
                Item<%= result.total_items > 1 ? 's' : '' %>
              <% else %>  
                <%= result.total_items > 1 ? bento_title(key) : bento_blacklight_format(key) %>
                from Catalog
              <% end %>
            <% end %>
          <% end %>  
          <i class="fa fa-angle-double-right"></i>
        <% end %>
      <% end %>
      <% if is_catalog_pane?(bento_title(key)) == true %>
        <div class="bento_pane_advanced">
          <% qp2 = "f%5Bformat%5D%5B%5D=#{bento_blacklight_format(key)}&op_row%5B%5D=AND&q_row%5B%5D=#{ss_uri_encode(params[:q]).gsub('&','%26')}&search_field_row%5B%5D=all_fields" %>
          or use <%= link_to 'advanced search',"edit?#{qp2}", {:onclick => "javascript:_paq.push(['trackEvent', 'advancedLink', '#{bento_blacklight_format(key)}'])"}  %>
        </div>
      <% end %>
    </div>
<% end %>
