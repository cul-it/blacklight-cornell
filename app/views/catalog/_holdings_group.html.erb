
<% reading = '' %>
<% bwith = '' %>
<% if @document['bound_with_json'] %>
  <% bwith = t('blacklight.catalog.bound_with') %>
<% end %>
<% multi_vol = @document['multivol_b'] %>
<% on_site_count = 0 %>
<% reserve_item = false %>
<% noncirc = false %>
<% aeon_codes = [] %>
<% not_spif = 0  %>
<% spif = 0  %>

<% if group == "Rare" %>
<% reading = ' for Reading Room Delivery' %>
<% noncirc = true  %>
<% end %>

<% items.each do |i| %>
  <% if group == "Rare" %>
    <% aeon_codes << i['location']['code'] unless aeon_codes.include?(i['location']['code']) %>
  <% end %>

  <div class="holding">
  <% reserve_item = (i['location']['code'].include?(',res') ||  i['location']['code'].include?('oclc,afrp') || i['location']['name'].include?('Reserve')) %>
  <% if i["location"]["name"] !~ /Spacecraft Planetary Imaging Facility/ %>
    <% not_spif += 1  %>
  <% end %>
  <% if i["location"]["name"] =~ /Non-Circulating/ %>
    <% noncirc = true  %>
  <% end %>
  <% if i["location"]["name"] =~ /Spacecraft Planetary Imaging Facility/ %>
    <% noncirc = true  %>
    <% spif += 1  %>
  <% end %>
    <!-- location -->

    <% if !i["call"].blank? && !i["call"].include?('No call number') && i["call"] == 'Available for the Library to Purchase' %>
      <% pda = 'yes' %>
    <% end %>

    <% if pda == 'yes' %>
      <div class="location">
        <%= i["call"] %>
      </div>
    <% elsif i["location"]["name"] != 'Library Technical Services Review Shelves' and !@document['url_pda_display'].present? %>
      <div class="location">
        <%= i["location"]["name"] %>
        <span class="map-it">
          <%= render_location_link i['location']['code'] %>
        </span>
      </div>
    <% end %>

    <% if !i["call"].blank? && !i["call"].include?('No call number') && i["call"] == 'Available for the Library to Purchase' %>
      <% pda = 'yes' %>
    <% end %>

    <% if !i["call"].blank? && !i["call"].include?('No call number') && i["call"] != '' %>
      <div class="call-number">
      <% if pda != 'yes' %>
        <%= i["call"] %>
        <span class="text-it">
        <%= link_to sms_solr_document_path(:id => params[:id], :location => i["location"]["name"], :callnumber => i["call"]), {:id => 'smsLink', :name => 'Text', :class => 'lightboxLink', :data => {:toggle => 'tooltip', :placement => 'right'}, :title =>
            'Text call number'} do %>
          <i class="fa fa-mobile" aria-hidden="true"></i>
            <%= t('blacklight.tools.sms') %>
        <% end %>
      <% end %>
      <% end %>
      </div>

      <!-- holding description, notes, status -->

      <div class="group">
        <% if i['items']['tempLoc'].present? %>
        <% i['items']['tempLoc'].each do |t| %>
          <div class="message">
            <%= t["enum"] %> Temporarily shelved in <%= t["location"]["name"] %>
          </div>
        <% end %>
        <% end %>


        <div class="message">
          <% if i["holdings"].present? %>
            Library has: <%= i["holdings"].join('<br />').html_safe %>
          <% end %>
        </div>

        <div class="message">
          <% if i["supplements"].present? %>
            Supplements: <%= i["supplements"].join('<br />').html_safe %>
          <% end %>
        </div>

        <div class="message">
          <% if i["notes"].present? %>
          Notes: <%= i["notes"].join('<br />').html_safe %>
          <% end %>
        </div>

        <%= render 'solr_status',:i => i, :location => i["location"]["name"], :pda => pda, :callnumber => i["call"], :noncirc=>noncirc,:multi_vol =>multi_vol,:bwith=>bwith,:on_site_count=>on_site_count %>
      </div>
      <% end %>

  <%= render 'request_buttons', :group => group, :noncirc => noncirc, :@document => @document, :aeon_codes => aeon_codes, :not_spif => not_spif, :spif => :spif, :reading => reading, :reserve_item => reserve_item %>
